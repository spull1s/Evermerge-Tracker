<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EverMerge Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f0f4f8;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .progress-purple { background: linear-gradient(90deg, #8b5cf6 0%, #d946ef 100%); }
        .progress-orange { background: linear-gradient(90deg, #f97316 0%, #facc15 100%); }
        .progress-blue { background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%); }
        .progress-yellow { background: linear-gradient(90deg, #eab308 0%, #fde047 100%); }
        .progress-brown { background: linear-gradient(90deg, #78350f 0%, #d97706 100%); }
        .progress-teal { background: linear-gradient(90deg, #0d9488 0%, #2dd4bf 100%); }
        
        input[type="number"] { font-size: 16px; }
        
        .item-btn {
            transition: all 0.2s;
            border: 2px solid transparent;
            user-select: none;
            cursor: pointer;
        }
        .item-btn.active {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: scale(1.05);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .star-active { color: #eab308; text-shadow: 0 0 8px rgba(234, 179, 8, 0.6); transform: scale(1.2); }
        .star-inactive { color: #d1d5db; }

        .map-selector {
            background: #f3f4f6;
            padding: 4px 12px;
            border-radius: 999px;
            font-weight: 800;
            font-size: 12px;
            color: #4b5563;
            border: 2px solid #e5e7eb;
        }
    </style>
</head>
<body class="p-4 pb-12 text-gray-800">

    <div class="max-w-md mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mt-2 mb-4">
            <h1 id="app-title" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-orange-500">
                EverMerge Hub üß©
            </h1>
            <button id="home-btn" onclick="goToDashboard()" class="hidden bg-white p-3 rounded-2xl shadow-sm border border-gray-100 active:bg-gray-50">
                üè† <span class="text-[10px] font-bold uppercase ml-1">Hem</span>
            </button>
        </header>

        <!-- Persistent Progress Header (Hidden for Backpack as it has custom bars) -->
        <div id="progress-header" class="hidden mb-6">
            <div id="result-card" class="card p-4 border-t-8 border-purple-500">
                <div class="flex justify-between items-end mb-2">
                    <span id="progress-label" class="text-[8px] font-black text-gray-400 uppercase tracking-widest leading-none">Status</span>
                    <span id="percent-display" class="text-2xl font-black text-gray-800 leading-none">0%</span>
                </div>
                <div class="w-full bg-gray-100 h-4 rounded-full overflow-hidden mb-2">
                    <div id="main-progress-bar" class="h-full w-0 transition-all duration-700 ease-out"></div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-[10px] font-bold text-gray-400" id="total-display">0 / 0</div>
                </div>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="view-dashboard" class="space-y-6">
            <!-- Long Term Goals -->
            <div>
                <h3 class="text-[10px] font-black uppercase text-gray-400 mb-3 tracking-widest ml-1">L√•ngsiktiga M√•l üèÜ</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div onclick="switchTab('castles')" class="card p-4 flex flex-col items-center border-b-4 border-yellow-500 active:scale-95 transition-transform">
                        <span class="text-2xl">üè∞</span>
                        <span class="text-[10px] font-bold uppercase text-gray-500 mt-1">Slott</span>
                    </div>
                    <div onclick="switchTab('heroes')" class="card p-4 flex flex-col items-center border-b-4 border-blue-500 active:scale-95 transition-transform">
                        <span class="text-2xl">ü¶∏‚Äç‚ôÇÔ∏è</span>
                        <span class="text-[10px] font-bold uppercase text-gray-500 mt-1">Heroes</span>
                    </div>
                    <div onclick="switchTab('backpack')" class="card p-4 flex flex-col items-center border-b-4 border-amber-800 active:scale-95 transition-transform">
                        <span class="text-2xl">üéí</span>
                        <span class="text-[10px] font-bold uppercase text-gray-500 mt-1">Backpack</span>
                    </div>
                    <div onclick="switchTab('rares')" class="card p-4 flex flex-col items-center border-b-4 border-pink-500 active:scale-95 transition-transform">
                        <span class="text-2xl">‚ú®</span>
                        <span class="text-[10px] font-bold uppercase text-gray-500 mt-1">Rares</span>
                    </div>
                </div>
            </div>

            <!-- Time Sensitive Events -->
            <div>
                <h3 class="text-[10px] font-black uppercase text-gray-400 mb-3 tracking-widest ml-1">Event & √ñvrigt ‚è≥</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div onclick="switchTab('treasure')" class="card p-3 flex flex-row items-center gap-3 border-l-4 border-purple-500 active:scale-95 transition-transform">
                        <span class="text-xl">üì¶</span>
                        <span class="text-[10px] font-black uppercase text-gray-600 leading-tight">Treasure Hunt</span>
                    </div>
                    <div onclick="switchTab('legendary')" class="card p-3 flex flex-row items-center gap-3 border-l-4 border-orange-500 active:scale-95 transition-transform">
                        <span class="text-xl">ü¶Ñ</span>
                        <span class="text-[10px] font-black uppercase text-gray-600 leading-tight">Legendaries</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Castles -->
        <div id="section-castles" class="hidden">
            <div class="card p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest">V√§lj Slott</h4>
                    <select id="castle-map-filter" onchange="renderCastleGrid()" class="map-selector">
                        <option value="Mainland">üìç Mainland</option>
                        <option value="Cove">üèùÔ∏è Paradise Cove</option>
                    </select>
                </div>
                <div id="castle-grid" class="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto no-scrollbar p-1"></div>
            </div>
            
            <div id="castle-details" class="card p-6 mb-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 id="current-castle-name" class="text-2xl font-black text-yellow-600 uppercase italic leading-tight">V√§lj ett slott</h2>
                    <div id="star-rating" class="flex text-2xl gap-1"></div>
                </div>
                <div id="castle-tiers-info" class="text-[10px] font-bold text-gray-400 uppercase mb-4 tracking-wider">Antal tiers: <span id="castle-tier-count" class="text-yellow-600">--</span></div>

                <div class="mb-6 p-4 bg-purple-50 rounded-2xl border-l-4 border-purple-400">
                    <h3 class="text-[11px] font-black text-purple-800 uppercase tracking-widest mb-2">Mystic Isle-drops üéÅ</h3>
                    <div id="castle-drops-list" class="space-y-1">
                        <div id="drop-common" class="text-lg font-bold text-gray-700">---</div>
                        <div id="drop-rare" class="text-lg font-bold text-purple-600">---</div>
                    </div>
                </div>
                
                <div class="p-4 bg-yellow-50 rounded-2xl border-l-4 border-yellow-400">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-xs font-bold text-gray-600 italic uppercase">Uppgradering</p>
                            <p class="text-[10px] text-gray-400">Beh√∂vs: <span id="castle-target-pieces" class="font-black text-yellow-600">4</span> st sista tier</p>
                        </div>
                        <input type="number" id="castle-pieces-input" value="0" min="0" oninput="calculateCastle()" class="w-16 text-center font-black text-xl text-yellow-600 bg-white rounded-xl border border-yellow-100 p-2">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Backpack -->
        <div id="section-backpack" class="hidden">
            <div class="card p-6 mb-4">
                <h2 class="text-2xl font-black text-amber-800 uppercase italic mb-6">Backpack Slots üéí</h2>
                
                <div class="space-y-6 mb-8">
                    <!-- Mainland Progress -->
                    <div class="bg-amber-50 p-4 rounded-2xl border border-amber-100">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-[11px] font-black text-amber-700 uppercase tracking-wider">Mainland (HI)</label>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold text-amber-500 uppercase">Capacity:</span>
                                <input type="number" id="bp-hi-input" value="0" min="0" max="99" oninput="calculateBackpack()" class="w-14 text-center text-lg font-black bg-white rounded-lg border border-amber-200 p-1">
                            </div>
                        </div>
                        <div class="w-full bg-amber-100/50 h-3 rounded-full overflow-hidden mb-2">
                            <div id="bp-hi-bar" class="h-full w-0 progress-brown transition-all duration-500"></div>
                        </div>
                        <div class="flex justify-between text-[9px] font-bold uppercase text-amber-600">
                            <span id="bp-hi-stat">0 / 99 Slots</span>
                            <span id="bp-hi-remaining">99 st T8 kvar</span>
                        </div>
                    </div>

                    <!-- PC Progress -->
                    <div class="bg-teal-50 p-4 rounded-2xl border border-teal-100">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-[11px] font-black text-teal-700 uppercase tracking-wider">Paradise Cove</label>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold text-teal-500 uppercase">Capacity:</span>
                                <input type="number" id="bp-pc-input" value="0" min="0" max="99" oninput="calculateBackpack()" class="w-14 text-center text-lg font-black bg-white rounded-lg border border-teal-200 p-1">
                            </div>
                        </div>
                        <div class="w-full bg-teal-100/50 h-3 rounded-full overflow-hidden mb-2">
                            <div id="bp-pc-bar" class="h-full w-0 progress-teal transition-all duration-500"></div>
                        </div>
                        <div class="flex justify-between text-[9px] font-bold uppercase text-teal-600">
                            <span id="bp-pc-stat">0 / 99 Slots</span>
                            <span id="bp-pc-remaining">99 st T8 kvar</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-2xl p-4">
                    <h3 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4 text-center">Total resurshunger (B√•da √∂ar) üíé</h3>
                    <div id="bp-needed-list" class="grid grid-cols-2 gap-2">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Rare Tracker -->
        <div id="section-rares" class="hidden">
            <div id="rare-grid" class="grid grid-cols-3 gap-2 p-2 mb-4 bg-white rounded-2xl shadow-inner max-h-64 overflow-y-auto no-scrollbar"></div>
            <div id="rare-details" class="card p-6">
                <h2 id="current-rare-name" class="text-2xl font-black text-pink-500 uppercase italic mb-4">V√§lj djur ‚ú®</h2>
                <div id="rare-merger-ui" class="space-y-3 hidden">
                    <div id="rare-tiers-container" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Section Heroes -->
        <div id="section-heroes" class="hidden">
            <div class="card p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest">V√§lj Hj√§lte</h4>
                    <select id="hero-map-filter" onchange="renderHeroGrid()" class="map-selector">
                        <option value="Mainland">üìç Mainland</option>
                        <option value="Cove">üèùÔ∏è Paradise Cove</option>
                    </select>
                </div>
                <div id="hero-grid" class="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto no-scrollbar p-1"></div>
            </div>
            
            <div id="hero-details" class="card p-6">
                <h2 id="current-hero-name" class="text-2xl font-black text-blue-600 uppercase italic mb-4 leading-tight">V√§lj hj√§lte</h2>
                <div id="hero-merger-ui" class="space-y-2 hidden">
                    <div id="hero-tiers-container" class="space-y-1"></div>
                </div>
            </div>
        </div>

        <!-- Placeholders -->
        <div id="section-treasure" class="hidden p-4 card text-center"><p class="font-bold">üì¶ Treasure Hunt Tracker coming soon</p></div>
        <div id="section-legendary" class="hidden p-4 card text-center"><p class="font-bold">ü¶Ñ Legendary Tracker coming soon</p></div>

    </div>

    <script>
        // Data Structures
        const castles = [
            { name: "Beauty", common: "Butterfly", rare: "Fluffy", map: "Mainland", tiers: 7 },
            { name: "Boots", common: "Ladybug", rare: "Stegosaurus", map: "Mainland", tiers: 8 },
            { name: "Bunyan", common: "Bee", rare: "Jackalope", map: "Mainland", tiers: 8 },
            { name: "Mermaid", common: "Frog", rare: "Golden Goose", map: "Mainland", tiers: 8 },
            { name: "Pan", common: "Calico Cat", rare: "Sabertooth Tiger", map: "Mainland", tiers: 9 },
            { name: "Red", common: "Blue Penguin", rare: "Woolly Mammoth", map: "Mainland", tiers: 9 },
            { name: "Rapunzel", common: "Dodo", rare: "Manticore", map: "Mainland", tiers: 9 },
            { name: "Pinocchio", common: "Red Panda", rare: "Griffin", map: "Mainland", tiers: 9 },
            { name: "Sinbad", common: "Hedgehog", rare: "Thunderbird", map: "Mainland", tiers: 10 },
            { name: "Thumbelina", common: "Sugar Glider", rare: "Loch Ness Monster", map: "Mainland", tiers: 10 },
            { name: "Snow", common: "Polar Bear", rare: "Dragon", map: "Mainland", tiers: 10 },
            { name: "Cinderella", common: "Cheetah", rare: "Kraken", map: "Mainland", tiers: 11 },
            { name: "Merlin", common: "Giraffe", rare: "Phoenix", map: "Mainland", tiers: 12 },
            { name: "Outpost", common: "Ostrich", rare: "Saber Tooth Tiger", map: "Cove", tiers: 7 },
            { name: "Maui", common: "Red Panda", rare: "Brontosaurus", map: "Cove", tiers: 7 },
            { name: "Mulan", common: "Giraffe", rare: "Sea-Lion", map: "Cove", tiers: 8 },
            { name: "Rabbit", common: "Grizzly Bear", rare: "Stegosaurus", map: "Cove", tiers: 8 },
            { name: "Kintaro", common: "Elephant", rare: "Calygreyhound", map: "Cove", tiers: 8 },
            { name: "Baba Yaga", common: "Zebra", rare: "Platypus", map: "Cove", tiers: 8 },
            { name: "Snow Queen", common: "Owl", rare: "Hippocamp", map: "Cove", tiers: 9 },
            { name: "Frog Prince", common: "Panda", rare: "Peryton", map: "Cove", tiers: 9 },
            { name: "Alice", common: "Crocodile", rare: "Flying monkey", map: "Cove", tiers: 9 },
            { name: "Nemo", common: "Alpaca", rare: "Quetzalcoatl", map: "Cove", tiers: 10 },
            { name: "Bell", common: "Tortois", rare: "Dodo bird", map: "Cove", tiers: 10 },
            { name: "Henry", common: "Peacock", rare: "Griffin", map: "Cove", tiers: 10 },
            { name: "Gale", common: "Lion", rare: "Direwolf", map: "Cove", tiers: 11 },
            { name: "Monkey King", common: "üêí", rare: "üêí", map: "Cove", tiers: 12 }
        ];

        const rareAnimals = ["Unicorn", "Flooficore", "Mammoth", "Direwolf", "Jackalope", "Griffin", "Quetzalcoatl", "Peryton", "Flying Monkey", "Dodo Bird", "Sabre tooth tiger", "Triceratops", "Pterodactyl", "Centicore", "Brontosaurus", "Stegosaurus", "Sealion", "Hippocamp", "Calygreyhound", "Platypus"];
        
        const heroes = [
            { name: "Sleeping Beauty", steps: 8, map: "Mainland" },
            { name: "Puss in Boots", steps: 8, map: "Mainland" },
            { name: "Paul Bunyan", steps: 8, map: "Mainland" },
            { name: "The Little Mermaid", steps: 8, map: "Mainland" },
            { name: "Peter Pan", steps: 9, map: "Mainland" },
            { name: "Red Riding Hood", steps: 9, map: "Mainland" },
            { name: "Rapunzel", steps: 9, map: "Mainland" },
            { name: "Pinocchio", steps: 9, map: "Mainland" },
            { name: "Sinbad", steps: 10, map: "Mainland" },
            { name: "Thumbelina", steps: 10, map: "Mainland" },
            { name: "Snow White", steps: 10, map: "Mainland" },
            { name: "Cinderella", steps: 10, map: "Mainland" },
            { name: "Merlin", steps: 10, map: "Mainland" },
            { name: "Maui", steps: 8, map: "Cove" },
            { name: "Mulan", steps: 8, map: "Cove" },
            { name: "White Rabbit", steps: 9, map: "Cove" },
            { name: "Kintaro", steps: 9, map: "Cove" },
            { name: "Baba Yaga", steps: 9, map: "Cove" },
            { name: "Snow Queen", steps: 10, map: "Cove" },
            { name: "Frog Prince", steps: 10, map: "Cove" },
            { name: "Alice", steps: 10, map: "Cove" }
        ];

        // State Management
        let currentCastle = "Beauty";
        let currentRare = "";
        let currentHero = "";
        let appData = JSON.parse(localStorage.getItem('emHubData_v6') || '{"castles":{}, "rares":{}, "heroes":{}, "backpack":{"hi":0, "pc":0}}');

        window.onload = () => {
            renderCastleGrid();
            renderRareGrid();
            renderHeroGrid();
            // Sync inputs with stored data
            document.getElementById('bp-hi-input').value = appData.backpack.hi || 0;
            document.getElementById('bp-pc-input').value = appData.backpack.pc || 0;
            calculateBackpack();
        };

        function save() {
            localStorage.setItem('emHubData_v6', JSON.stringify(appData));
        }

        // Navigation
        function goToDashboard() {
            document.querySelectorAll('[id^="section-"]').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-dashboard').classList.remove('hidden');
            document.getElementById('home-btn').classList.add('hidden');
            document.getElementById('progress-header').classList.add('hidden');
            document.getElementById('app-title').innerText = "EverMerge Hub üß©";
        }

        function switchTab(tab) {
            document.querySelectorAll('[id^="section-"]').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById(`section-${tab}`).classList.remove('hidden');
            document.getElementById('home-btn').classList.remove('hidden');
            
            // Handle Progress Header visibility
            if(tab === 'backpack') {
                document.getElementById('progress-header').classList.add('hidden');
            } else {
                document.getElementById('progress-header').classList.remove('hidden');
            }
            
            if(tab === 'castles') selectCastle(currentCastle);
            if(tab === 'backpack') calculateBackpack();
        }

        // Castle Logic
        function renderCastleGrid() {
            const map = document.getElementById('castle-map-filter').value;
            const grid = document.getElementById('castle-grid');
            grid.innerHTML = castles.filter(c => c.map === map).map(c => `
                <button onclick="selectCastle('${c.name}')" class="item-btn p-3 rounded-xl text-[10px] font-black uppercase truncate ${currentCastle === c.name ? 'active' : 'bg-gray-100'}">
                    ${c.name}
                </button>
            `).join('');
        }

        function selectCastle(name) {
            currentCastle = name;
            const castle = castles.find(c => c.name === name);
            if(!appData.castles[name]) appData.castles[name] = { star: 1, pieces: 0 };
            const data = appData.castles[name];
            document.getElementById('current-castle-name').innerText = name;
            document.getElementById('castle-pieces-input').value = data.pieces;
            document.getElementById('castle-tier-count').innerText = castle.tiers;
            renderStars(data.star);
            updateDrops(castle, data.star);
            calculateCastle();
            renderCastleGrid();
        }

        function renderStars(currentStar) {
            const container = document.getElementById('star-rating');
            let html = "";
            for(let i=1; i<=5; i++) {
                html += `<span onclick="setCastleStar(${i})" class="cursor-pointer transition-all duration-300 ${i <= currentStar ? 'star-active' : 'star-inactive'}">‚òÖ</span>`;
            }
            container.innerHTML = html;
        }

        function setCastleStar(star) {
            appData.castles[currentCastle].star = star;
            save();
            renderStars(star);
            updateDrops(castles.find(c => c.name === currentCastle), star);
            calculateCastle();
        }

        function updateDrops(castle, star) {
            document.getElementById('drop-common').innerText = `üêæ ${star} ${castle.common}`;
            const rareCount = star >= 3 ? star - 2 : 0;
            document.getElementById('drop-rare').innerText = `‚ú® ${rareCount} ${castle.rare}`;
            document.getElementById('drop-rare').style.opacity = star >= 3 ? "1" : "0.3";
        }

        function calculateCastle() {
            const data = appData.castles[currentCastle];
            data.pieces = parseInt(document.getElementById('castle-pieces-input').value) || 0;
            save();
            const target = [0, 4, 3, 4, 5, 6][data.star];
            const pct = Math.min(Math.round((data.pieces / target) * 100), 100);
            document.getElementById('percent-display').innerText = pct + '%';
            document.getElementById('main-progress-bar').style.width = pct + '%';
            document.getElementById('main-progress-bar').className = "progress-yellow h-full";
            document.getElementById('total-display').innerText = `${data.pieces} / ${target}`;
        }

        // Backpack Logic
        function calculateBackpack() {
            const hi = parseInt(document.getElementById('bp-hi-input').value) || 0;
            const pc = parseInt(document.getElementById('bp-pc-input').value) || 0;
            
            appData.backpack = { hi, pc };
            save();

            // Calculate HI
            const hiPct = Math.min(Math.round((hi / 99) * 100), 100);
            document.getElementById('bp-hi-bar').style.width = hiPct + '%';
            document.getElementById('bp-hi-stat').innerText = `${hi} / 99 Slots`;
            document.getElementById('bp-hi-remaining').innerText = `${99 - hi} st T8 kvar`;

            // Calculate PC
            const pcPct = Math.min(Math.round((pc / 99) * 100), 100);
            document.getElementById('bp-pc-bar').style.width = pcPct + '%';
            document.getElementById('bp-pc-stat').innerText = `${pc} / 99 Slots`;
            document.getElementById('bp-pc-remaining').innerText = `${99 - pc} st T8 kvar`;

            // Totals for the list
            const totalRemaining = (99 - hi) + (99 - pc);
            const t8Needed = totalRemaining;
            
            const list = document.getElementById('bp-needed-list');
            const tiers = [
                { lvl: 8, rate: 1, needed: t8Needed },
                { lvl: 7, rate: 2, needed: t8Needed * 2 },
                { lvl: 6, rate: 4, needed: t8Needed * 4 },
                { lvl: 5, rate: 5, needed: t8Needed * 10 },
                { lvl: 4, rate: 5, needed: t8Needed * 25 },
                { lvl: 3, rate: 5, needed: t8Needed * 63 },
                { lvl: 2, rate: 5, needed: t8Needed * 157 },
                { lvl: 1, rate: 5, needed: t8Needed * 393 }
            ];

            list.innerHTML = tiers.map(t => `
                <div class="flex justify-between items-center bg-white px-2 py-1 rounded-lg shadow-sm border border-gray-100">
                    <span class="text-[9px] font-black text-amber-900">T${t.lvl}</span>
                    <span class="text-[10px] font-black text-amber-600">${t.needed.toLocaleString()}</span>
                </div>
            `).join('');
        }

        // Rare Tracker Logic
        function renderRareGrid() {
            const grid = document.getElementById('rare-grid');
            grid.innerHTML = rareAnimals.map(a => `
                <button onclick="selectRare('${a}')" class="item-btn p-2 rounded-xl text-[9px] font-bold text-center ${currentRare === a ? 'active' : 'bg-gray-50'}">
                    ${a}
                </button>
            `).join('');
        }

        function selectRare(name) {
            currentRare = name;
            document.getElementById('current-rare-name').innerText = name;
            document.getElementById('rare-merger-ui').classList.remove('hidden');
            if(!appData.rares[name]) appData.rares[name] = Array(6).fill(0);
            const container = document.getElementById('rare-tiers-container');
            container.innerHTML = "";
            const goals = [250, 100, 40, 15, 5, 2];
            for(let i = 5; i >= 0; i--) {
                const row = document.createElement('div');
                row.className = "flex justify-between items-center p-3 bg-gray-50 rounded-xl";
                row.innerHTML = `
                    <div>
                        <span class="text-[10px] font-black text-gray-400 uppercase">Tier ${i + 1}</span>
                        <div class="text-[10px] text-gray-500">M√•l: <span class="font-bold">${goals[i]}</span> st</div>
                    </div>
                    <input type="number" class="w-16 text-center font-black text-pink-600 bg-white rounded-lg border border-gray-100 p-1" value="${appData.rares[name][i]}" min="0">
                `;
                const input = row.querySelector('input');
                input.oninput = (e) => {
                    appData.rares[name][i] = parseInt(e.target.value) || 0;
                    save();
                    calculateRareProgress();
                };
                container.appendChild(row);
            }
            renderRareGrid();
            calculateRareProgress();
        }

        function calculateRareProgress() {
            const counts = appData.rares[currentRare];
            const goals = [250, 100, 40, 15, 5, 2];
            let totalProgress = 0;
            counts.forEach((val, i) => totalProgress += (val / goals[i]));
            const pct = Math.min(Math.round((totalProgress / 6) * 100), 100);
            document.getElementById('percent-display').innerText = pct + '%';
            document.getElementById('main-progress-bar').style.width = pct + '%';
            document.getElementById('main-progress-bar').className = "progress-pink h-full";
            document.getElementById('total-display').innerText = "Rare Progress";
        }

        // Hero Tracker Logic
        function renderHeroGrid() {
            const map = document.getElementById('hero-map-filter').value;
            const grid = document.getElementById('hero-grid');
            grid.innerHTML = heroes.filter(h => h.map === map).map(h => `
                <button onclick="selectHero('${h.name}')" class="item-btn p-3 rounded-xl text-[10px] font-black uppercase truncate ${currentHero === h.name ? 'active' : 'bg-gray-100'}">
                    ${h.name}
                </button>
            `).join('');
        }

        function selectHero(name) {
            currentHero = name;
            const hero = heroes.find(h => h.name === name);
            document.getElementById('current-hero-name').innerText = name;
            document.getElementById('hero-merger-ui').classList.remove('hidden');
            if(!appData.heroes[name]) appData.heroes[name] = Array(hero.steps).fill(0);
            const container = document.getElementById('hero-tiers-container');
            container.innerHTML = "";
            const goals = [];
            for(let i=0; i<hero.steps; i++) {
                goals.push(Math.pow(2.5, hero.steps - 1 - i).toFixed(0));
            }
            for(let i = hero.steps - 1; i >= 0; i--) {
                const row = document.createElement('div');
                row.className = "flex justify-between items-center p-2 bg-blue-50/50 rounded-lg";
                row.innerHTML = `
                    <span class="text-[9px] font-bold text-blue-800">Lvl ${i+1}</span>
                    <div class="flex items-center gap-2">
                        <span class="text-[8px] text-gray-400">Beh√∂vs: ${goals[i]}</span>
                        <input type="number" class="w-12 text-center text-xs font-bold border rounded p-1" value="${appData.heroes[name][i] || 0}">
                    </div>
                `;
                const input = row.querySelector('input');
                input.oninput = (e) => {
                    appData.heroes[name][i] = parseInt(e.target.value) || 0;
                    save();
                    calculateHeroProgress();
                };
                container.appendChild(row);
            }
            renderHeroGrid();
            calculateHeroProgress();
        }

        function calculateHeroProgress() {
            document.getElementById('percent-display').innerText = 'Hj√§lte';
            document.getElementById('main-progress-bar').style.width = '100%';
            document.getElementById('main-progress-bar').className = "progress-blue h-full";
            document.getElementById('total-display').innerText = currentHero;
        }
    </script>
</body>
</html>